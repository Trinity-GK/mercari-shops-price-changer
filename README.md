# Mercari Shops Price Automation - Firefox Extension

[English](#english) | [æ—¥æœ¬èª](#æ—¥æœ¬èª)

---

## æ—¥æœ¬èª

ãƒ¡ãƒ«ã‚«ãƒªShopså•†å“ã®ä¸€æ‹¬ä¾¡æ ¼èª¿æ•´ã‚’è‡ªå‹•åŒ–ã™ã‚‹Firefoxæ‹¡å¼µæ©Ÿèƒ½ã§ã™ã€‚å•†å“ã‚’ä¸€æ™‚çš„ã«å€¤ä¸‹ã’ã—ã€æ™‚é–“çµŒéã¾ãŸã¯æ³¨æ–‡æ•°ã«åŸºã¥ã„ã¦è‡ªå‹•çš„ã«å…ƒã®ä¾¡æ ¼ã«æˆ»ã—ã¾ã™ã€‚

### ğŸŒŸ ä¸»ãªæ©Ÿèƒ½

- **ä¸€æ‹¬ä¾¡æ ¼èª¿æ•´**: ã‚·ãƒ§ãƒƒãƒ—å†…ã®å…¨å•†å“ã®ä¾¡æ ¼ã‚’è‡ªå‹•èª¿æ•´
- **ã‚¹ãƒãƒ¼ãƒˆå•†å“é™¤å¤–**: ã€Œç™ºé€å¾…ã¡ã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®æ³¨æ–‡ãŒã‚ã‚‹å•†å“ã‚’è‡ªå‹•é™¤å¤–
- **æœ€ä½ä¾¡æ ¼ä¿è­·ï¼ˆ300å††ï¼‰**: 300å††ä»¥ä¸‹ã«ãªã‚‹å•†å“ã¯é€†ã«å€¤ä¸Šã’
- **2ã¤ã®å¾©å…ƒãƒˆãƒªã‚¬ãƒ¼**: 
  - **æ™‚é–“ãƒ™ãƒ¼ã‚¹**: æŒ‡å®šæ™‚é–“çµŒéå¾Œã«å¾©å…ƒ
  - **æ³¨æ–‡ãƒ™ãƒ¼ã‚¹**: æ–°è¦æ³¨æ–‡ãŒé–¾å€¤ã«é”ã—ãŸã‚‰å³åº§ã«å¾©å…ƒï¼ˆæ—©ã„æ–¹ãŒå„ªå…ˆï¼‰
- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–**: ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—UIã§é€²æ—ã¨çµ±è¨ˆã‚’è¿½è·¡
- **ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å‹•ä½œ**: ãƒ–ãƒ©ã‚¦ã‚¶æ“ä½œã‚’å¦¨ã’ãšã«å®Ÿè¡Œ
- **ãƒã‚¤ãƒªãƒ³ã‚¬ãƒ«å¯¾å¿œ**: å®Œå…¨ãªæ—¥è‹±å¯¾å¿œ

### ğŸ”§ ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

#### ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘

1. **æ‹¡å¼µæ©Ÿèƒ½ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ï¼ˆFirefox Add-onsã§å…¬é–‹å¾Œï¼‰ã¾ãŸã¯æ‰‹å‹•ã§ãƒ­ãƒ¼ãƒ‰:
   - ã“ã®ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã¾ãŸã¯ã‚¯ãƒ­ãƒ¼ãƒ³
   - Firefoxã§ `about:debugging` ã‚’é–‹ã
   - ã€Œã“ã®Firefoxã€ã‚’ã‚¯ãƒªãƒƒã‚¯
   - ã€Œä¸€æ™‚çš„ãªã‚¢ãƒ‰ã‚ªãƒ³ã‚’èª­ã¿è¾¼ã‚€ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
   - ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰ `manifest.json` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ

2. **å®Œäº†ï¼** è¿½åŠ ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã¯ä¸è¦ã§ã™ã€‚æ‹¡å¼µæ©Ÿèƒ½ã¯å®Œå…¨ã«ãƒ–ãƒ©ã‚¦ã‚¶å†…ã§å‹•ä½œã—ã¾ã™ã€‚

#### é–‹ç™ºè€…å‘ã‘

**å‰ææ¡ä»¶**ï¼ˆé–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆã®ã¿ï¼‰:
- Node.jsã¨npmï¼ˆé–‹ç™ºãƒ„ãƒ¼ãƒ«ã¨ãƒ†ã‚¹ãƒˆç”¨ï¼‰
- Firefoxãƒ–ãƒ©ã‚¦ã‚¶

**é–‹ç™ºç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—:**

1. **ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«:**
   ```bash
   npm install
   ```

2. **web-extã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆæ¨å¥¨ï¼‰:**
   ```bash
   npm install -g web-ext
   ```

### ğŸš€ é–‹ç™º

#### Firefoxã§æ‹¡å¼µæ©Ÿèƒ½ã‚’å®Ÿè¡Œ

```bash
npm start
```

ã“ã‚Œã«ã‚ˆã‚Š:
- æ‹¡å¼µæ©Ÿèƒ½ã‚’èª­ã¿è¾¼ã‚“ã FirefoxãŒèµ·å‹•
- ãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´ã‚’ç›£è¦–ã—ã¦è‡ªå‹•ãƒªãƒ­ãƒ¼ãƒ‰
- ãƒ‡ãƒãƒƒã‚°ç”¨ã®ãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãŒé–‹ã

#### æ‹¡å¼µæ©Ÿèƒ½ã‚’ãƒ“ãƒ«ãƒ‰

```bash
npm run build
```

Mozilla Add-onsã¸ã®æå‡ºç”¨ã« `web-ext-artifacts/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã« `.zip` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚

#### æ‹¡å¼µæ©Ÿèƒ½ã‚’ãƒªãƒ³ãƒˆ

```bash
npm run lint
```

#### ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ

```bash
npm test
```

**æ³¨æ„**: Node.jsã¨npmã¯é–‹ç™ºãƒ„ãƒ¼ãƒ«ï¼ˆ`web-ext`ã€ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼‰ã«ã®ã¿å¿…è¦ã§ã™ã€‚æ‹¡å¼µæ©Ÿèƒ½è‡ªä½“ã¯å¤–éƒ¨ä¾å­˜é–¢ä¿‚ãªã—ã§å®Œå…¨ã«Firefoxå†…ã§å‹•ä½œã—ã¾ã™ã€‚

### ğŸ“‹ åˆæœŸè¨­å®š

1. **Firefoxã«æ‹¡å¼µæ©Ÿèƒ½ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**:
   - `npm start` ã§èµ·å‹•ï¼ˆé–‹ç™ºè€…å‘ã‘ï¼‰ã€ã¾ãŸã¯
   - `about:debugging` â†’ ã€Œä¸€æ™‚çš„ãªã‚¢ãƒ‰ã‚ªãƒ³ã‚’èª­ã¿è¾¼ã‚€ã€ â†’ `manifest.json` ã‚’é¸æŠ
2. **Firefoxãƒ„ãƒ¼ãƒ«ãƒãƒ¼ã®æ‹¡å¼µæ©Ÿèƒ½ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯**
3. **Shop IDã‚’å…¥åŠ›**:
   - mercari-shops.comã§ã‚·ãƒ§ãƒƒãƒ—ã‚’è¡¨ç¤ºã—ã¦ã„ã‚‹ã¨ãã®URLã‹ã‚‰ç¢ºèªã§ãã¾ã™
   - ä¾‹: `XbbLgd8ehsPWW6LWQKPGzN`
4. **ã€Œä¿å­˜ã—ã¦ç¶šè¡Œã€ã‚’ã‚¯ãƒªãƒƒã‚¯**

æ‹¡å¼µæ©Ÿèƒ½ã¯ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¯ãƒƒã‚­ãƒ¼ã‚’ä½¿ç”¨ã—ã¦ãƒ¡ãƒ«ã‚«ãƒªShopsã§èªè¨¼ã™ã‚‹ãŸã‚ã€APIãƒˆãƒ¼ã‚¯ãƒ³ã¯ä¸è¦ã§ã™ã€‚

### èªè¨¼æ–¹å¼

æ‹¡å¼µæ©Ÿèƒ½ã¯ **Web GraphQLã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ** (`https://mercari-shops.com/graphql`) ã‚’ä½¿ç”¨ã—ã¾ã™:
- ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒ­ã‚°ã‚¤ãƒ³ã‚»ãƒƒã‚·ãƒ§ãƒ³ï¼ˆã‚¯ãƒƒã‚­ãƒ¼ï¼‰ã‚’ä½¿ç”¨
- IPãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆè¦ä»¶ã‚’ãƒã‚¤ãƒ‘ã‚¹
- APIãƒˆãƒ¼ã‚¯ãƒ³ä¸è¦
- mercari-shops.comã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™

### ğŸ“– ä½¿ã„æ–¹

#### åŸºæœ¬çš„ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

1. **Firefoxã§mercari-shops.comã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª**
2. **æ‹¡å¼µæ©Ÿèƒ½ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯**ã—ã¦ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’é–‹ã
3. **è‡ªå‹•åŒ–è¨­å®šã‚’æ§‹æˆ**:
   - **å€¤ä¸‹ã’é¡**: å€¤ä¸‹ã’é‡‘é¡ï¼ˆå††ï¼‰ï¼ˆä¾‹: 100ã€200ï¼‰
   - **å¾©å…ƒé…å»¶**: è‡ªå‹•å¾©å…ƒã¾ã§ã®æ™‚é–“ï¼ˆåˆ†ï¼‰ï¼ˆä¾‹: 60ï¼‰
   - **æ³¨æ–‡é–¾å€¤**: å³åº§ã«å¾©å…ƒã‚’ãƒˆãƒªã‚¬ãƒ¼ã™ã‚‹æ–°è¦æ³¨æ–‡æ•°ï¼ˆä¾‹: 3ï¼‰
   - **ç›£è¦–é–“éš”**: æ–°è¦æ³¨æ–‡ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹é »åº¦ï¼ˆç§’ï¼‰ï¼ˆä¾‹: 30ï¼‰
4. **ã€Œä¾¡æ ¼èª¿æ•´ã‚’é–‹å§‹ã€ã‚’ã‚¯ãƒªãƒƒã‚¯**
5. **ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—UIã§é€²æ—ã‚’ç›£è¦–**
6. ä¾¡æ ¼ã¯è‡ªå‹•çš„ã«å¾©å…ƒã•ã‚Œã¾ã™ã€‚ã¾ãŸã¯ **ã€Œåœæ­¢ã—ã¦ä¾¡æ ¼ã‚’å¾©å…ƒã€** ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦å³åº§ã«å¾©å…ƒ

#### ä¾¡æ ¼å¤‰æ›´ã‚’ãƒ†ã‚¹ãƒˆï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

å®Œå…¨ãªè‡ªå‹•åŒ–ã‚’å®Ÿè¡Œã™ã‚‹å‰ã«ã€å˜ä¸€ã®å•†å“ã§ä¾¡æ ¼å¤‰æ›´ã‚’ãƒ†ã‚¹ãƒˆã§ãã¾ã™:

1. **ã€Œä¾¡æ ¼å¤‰æ›´ã‚’ãƒ†ã‚¹ãƒˆã€** ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
2. **å•†å“ID** ã‚’å…¥åŠ›
3. **æ–°ã—ã„ä¾¡æ ¼** ã‚’å…¥åŠ›ï¼ˆæœ€ä½300å††ï¼‰
4. **ã€Œä¾¡æ ¼å¤‰æ›´ã‚’ãƒ†ã‚¹ãƒˆã€** ã‚’ã‚¯ãƒªãƒƒã‚¯
5. ä¾¡æ ¼å¤‰æ›´ãŒæˆåŠŸã—ãŸã“ã¨ã‚’ç¢ºèª

### ğŸ”„ å‹•ä½œã®ä»•çµ„ã¿

#### ãƒ•ã‚§ãƒ¼ã‚ºA: ä¾¡æ ¼èª¿æ•´

1. ã‚·ãƒ§ãƒƒãƒ—ã‹ã‚‰å…¨å•†å“ã‚’å–å¾—
2. ã€Œç™ºé€å¾…ã¡ã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®æ³¨æ–‡ãŒã‚ã‚‹å•†å“ã‚’ç‰¹å®š
3. ç™ºé€å¾…ã¡ã®å•†å“ã‚’ **é™¤å¤–**
4. **å¯¾è±¡å•†å“** ã«å¯¾ã—ã¦:
   - **æ¨™æº–ã‚±ãƒ¼ã‚¹**: `æ–°ä¾¡æ ¼ = å…ƒã®ä¾¡æ ¼ - å€¤ä¸‹ã’é¡`
   - **300å††ä»¥ä¸‹ã‚±ãƒ¼ã‚¹**: `æ–°ä¾¡æ ¼ = å…ƒã®ä¾¡æ ¼ + å€¤ä¸‹ã’é¡`ï¼ˆåè»¢ï¼‰
5. ãƒ¡ãƒ«ã‚«ãƒªShops GraphQL APIã‚’ä»‹ã—ã¦å•†å“ã‚’æ›´æ–°

#### ãƒ•ã‚§ãƒ¼ã‚ºB: ç›£è¦–ã¨å¾©å…ƒ

1. æŒ‡å®šé–“éš”ï¼ˆä¾‹: 30ç§’ã”ã¨ï¼‰ã§æ–°è¦æ³¨æ–‡ã‚’ç›£è¦–
2. **ãƒ•ã‚§ãƒ¼ã‚ºAå®Œäº†å¾Œ** ã«ç™ºæ³¨ã•ã‚ŒãŸæ³¨æ–‡ã‚’è¿½è·¡ï¼ˆãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ï¼‰
3. ä»¥ä¸‹ã®å ´åˆã«ä¾¡æ ¼ã‚’å¾©å…ƒ:
   - **æ³¨æ–‡é–¾å€¤ã«é”ã—ãŸ**ã€ã¾ãŸã¯
   - **æ™‚é–“é…å»¶ãŒçµŒéã—ãŸ**ï¼ˆæ—©ã„æ–¹ãŒå„ªå…ˆï¼‰
4. ã™ã¹ã¦ã®ä¾¡æ ¼ã‚’å…ƒã®å€¤ã«å¾©å…ƒ
5. **å¾©å…ƒã¯1å›ã®è‡ªå‹•åŒ–å®Ÿè¡Œã«ã¤ã1å›ã®ã¿ãƒˆãƒªã‚¬ãƒ¼**

#### ä¾¡æ ¼è¨ˆç®—ã®ä¾‹

| å…ƒã®ä¾¡æ ¼ | å€¤ä¸‹ã’é¡ | çµæœ | ç†ç”± |
|---------|---------|-----|------|
| 1,000å†† | 100å†† | 900å†† | æ¨™æº–å€¤ä¸‹ã’ |
| 750å†† | 200å†† | 550å†† | æ¨™æº–å€¤ä¸‹ã’ |
| 399å†† | 100å†† | 499å†† | åè»¢ï¼ˆ300å††ä»¥ä¸‹ã«ãªã‚‹ãŸã‚ï¼‰ |
| 350å†† | 100å†† | 450å†† | åè»¢ï¼ˆ300å††ä»¥ä¸‹ã«ãªã‚‹ãŸã‚ï¼‰ |
| 301å†† | 50å†† | 351å†† | åè»¢ï¼ˆ300å††ä»¥ä¸‹ã«ãªã‚‹ãŸã‚ï¼‰ |

### ğŸ§ª ãƒ†ã‚¹ãƒˆ

#### ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸

**ãƒ„ãƒ¼ãƒ«/è¨­å®šãƒ¡ãƒ‹ãƒ¥ãƒ¼**ï¼ˆã¾ãŸã¯æ‹¡å¼µæ©Ÿèƒ½ã‚¢ã‚¤ã‚³ãƒ³ã‚’å³ã‚¯ãƒªãƒƒã‚¯ â†’ ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰ã‹ã‚‰ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹:

##### APIãƒ†ã‚¹ãƒˆ
- **æ¥ç¶šãƒ†ã‚¹ãƒˆ**: APIèªè¨¼ã‚’æ¤œè¨¼
- **Shop IDã‚’å–å¾—**: ã‚·ãƒ§ãƒƒãƒ—IDã‚’å–å¾—
- **å•†å“ã‚’å–å¾—**: å•†å“ãƒªã‚¹ãƒˆã‚’å–å¾—
- **æ³¨æ–‡ã‚’å–å¾—**: æ³¨æ–‡ãƒªã‚¹ãƒˆã‚’å–å¾—
- **ç™ºé€å¾…ã¡æ³¨æ–‡ã‚’å–å¾—**: ç™ºé€å¾…ã¡ã®å•†å“ã‚’å–å¾—
- **å•†å“è©³ç´°ã‚’å–å¾—**: ç·¨é›†ç”¨ã®å®Œå…¨ãªå•†å“ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
- **ä¾¡æ ¼ã‚’æ›´æ–°**: å˜ä¸€å•†å“ã®ä¾¡æ ¼å¤‰æ›´ã‚’ãƒ†ã‚¹ãƒˆ

##### Gherkinã‚·ãƒŠãƒªã‚ªãƒ†ã‚¹ãƒˆ

ãƒ©ã‚¤ãƒ–ä¾¡æ ¼å¤‰æ›´ã¨ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒãƒ¼ã‚’ä½¿ç”¨ã—ãŸå®Ÿéš›ã®è‡ªå‹•åŒ–ãƒ†ã‚¹ãƒˆ:

1. **ã‚·ãƒŠãƒªã‚ª1: æ¨™æº–ä¾¡æ ¼èª¿æ•´**
   - æ¨™æº–å€¤ä¸‹ã’è¨ˆç®—ã‚’ãƒ†ã‚¹ãƒˆ
   - å•†å“ã¯å€¤ä¸‹ã’ã•ã‚Œã€é…å»¶å¾Œã«å¾©å…ƒ

2. **ã‚·ãƒŠãƒªã‚ª2: æœ€ä½ä¾¡æ ¼ï¼ˆ300å††ï¼‰**
   - 300å††ã‚’ä¸‹å›ã‚‹å•†å“ã‚’ãƒ†ã‚¹ãƒˆ
   - åè»¢å‹•ä½œï¼ˆå€¤ä¸‹ã’ã§ã¯ãªãå€¤ä¸Šã’ï¼‰ã‚’æ¤œè¨¼

3. **ã‚·ãƒŠãƒªã‚ª3: å•†å“é™¤å¤–ï¼ˆç™ºé€å¾…ã¡ï¼‰**
   - ç™ºé€å¾…ã¡ã®å•†å“ãŒé™¤å¤–ã•ã‚Œã‚‹ã“ã¨ã‚’ãƒ†ã‚¹ãƒˆ
   - é™¤å¤–å•†å“ãŒå¤‰æ›´ã•ã‚Œãªã„ã“ã¨ã‚’æ¤œè¨¼

**âš ï¸ è­¦å‘Š**: ã‚·ãƒŠãƒªã‚ªãƒ†ã‚¹ãƒˆã¯å®Ÿéš›ã«ãƒ¡ãƒ«ã‚«ãƒªShopsã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®å•†å“ä¾¡æ ¼ã‚’å¤‰æ›´ã—ã¾ã™ã€‚æ³¨æ„ã—ã¦ä½¿ç”¨ã—ã¦ãã ã•ã„ï¼

### ğŸ› ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

#### æ‹¡å¼µæ©Ÿèƒ½ãŒå‹•ä½œã—ãªã„

1. **mercari-shops.comã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª**
   - Firefoxã§mercari-shops.comã‚’é–‹ã
   - ã‚·ãƒ§ãƒƒãƒ—ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª

2. **Shop IDã‚’ç¢ºèª**
   - æ‹¡å¼µæ©Ÿèƒ½ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— â†’ è¨­å®šç”»é¢ã¾ãŸã¯ãƒ¡ã‚¤ãƒ³UIãŒè¡¨ç¤ºã•ã‚Œã‚‹ã¯ãš
   - ã€ŒShop IDãŒå¿…è¦ã§ã™ã€ã¨è¡¨ç¤ºã•ã‚Œã‚‹å ´åˆã¯ã€URLã‹ã‚‰Shop IDã‚’å…¥åŠ›

3. **ãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ç¢ºèª**
   - æ‹¡å¼µæ©Ÿèƒ½ã‚¢ã‚¤ã‚³ãƒ³ã‚’å³ã‚¯ãƒªãƒƒã‚¯ â†’ èª¿æŸ»
   - ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ã‚¨ãƒ©ãƒ¼ã‚’ç¢ºèª

#### ä¾¡æ ¼å¤‰æ›´ãŒé©ç”¨ã•ã‚Œãªã„

1. **APIæ¥ç¶šã‚’ç¢ºèª**
   - ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ã‚’é–‹ãï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼‰
   - ã€Œæ¥ç¶šãƒ†ã‚¹ãƒˆã€ã‚’ã‚¯ãƒªãƒƒã‚¯
   - ã€Œæ¥ç¶šæˆåŠŸï¼ã€ã¨è¡¨ç¤ºã•ã‚Œã‚‹ã¯ãš

2. **å•†å“ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ç¢ºèª**
   - ç™ºé€å¾…ã¡ã®å•†å“ã¯è‡ªå‹•çš„ã«é™¤å¤–ã•ã‚Œã¾ã™
   - ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ã®ã€Œç™ºé€å¾…ã¡æ³¨æ–‡ã‚’å–å¾—ã€ã§é™¤å¤–å•†å“ã‚’ç¢ºèª

3. **å•†å“è©³ç´°ã‚’ç¢ºèª**
   - ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ã®ã€Œå•†å“è©³ç´°ã‚’å–å¾—ã€ã§å•†å“IDã‚’ä½¿ç”¨
   - å•†å“ã«å¿…è¦ãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆsnapshotIdã€variantsï¼‰ãŒã‚ã‚‹ã“ã¨ã‚’ç¢ºèª

#### å¾©å…ƒãŒãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œãªã„

1. **è‡ªå‹•åŒ–çŠ¶æ…‹ã‚’ç¢ºèª**
   - ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã«ç¾åœ¨ã®ãƒ•ã‚§ãƒ¼ã‚ºãŒè¡¨ç¤ºï¼ˆãƒ•ã‚§ãƒ¼ã‚ºAã€ãƒ•ã‚§ãƒ¼ã‚ºBã€å¾©å…ƒä¸­ã€å®Œäº†ï¼‰
   - æ®‹ã‚Šæ™‚é–“ã®ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ã§äºˆæƒ³å¾©å…ƒæ™‚é–“ã‚’è¡¨ç¤º

2. **æ³¨æ–‡é–¾å€¤ã‚’ç¢ºèª**
   - ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã®ã€Œé–‹å§‹å¾Œã®æ–°è¦æ³¨æ–‡æ•°ã€ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼
   - **ãƒ•ã‚§ãƒ¼ã‚ºAå®Œäº†å¾Œ** ã«ç™ºæ³¨ã•ã‚ŒãŸæ³¨æ–‡ã®ã¿ãŒé–¾å€¤ã«ã‚«ã‚¦ãƒ³ãƒˆã•ã‚Œã¾ã™

3. **ç›£è¦–é–“éš”ã‚’ç¢ºèª**
   - æ³¨æ–‡ã¯Nç§’ã”ã¨ï¼ˆè¨­å®šã«ã‚ˆã‚‹ï¼‰ã«ãƒã‚§ãƒƒã‚¯ã•ã‚Œã¾ã™
   - æ–°è¦æ³¨æ–‡ã®æ¤œå‡ºã«ã¯æœ€å¤§1ã‚µã‚¤ã‚¯ãƒ«åˆ†ã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™

### ğŸ“ ä»•æ§˜

è©³ç´°ãªä»•æ§˜ã¯ä»¥ä¸‹ã§ç¢ºèªã§ãã¾ã™:
- **`gherkin-tests.md`**: Gherkin/BDDã‚·ãƒŠãƒªã‚ªä»•æ§˜
- **`specs.md`**: æŠ€è¡“ãƒ†ã‚¹ãƒˆä»•æ§˜

### âš ï¸ å…è²¬äº‹é …

ã“ã®æ‹¡å¼µæ©Ÿèƒ½ã¯ãƒ¡ãƒ«ã‚«ãƒªShopsã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®å•†å“ä¾¡æ ¼ã‚’å¤‰æ›´ã—ã¾ã™ã€‚ä½¿ç”¨ã¯è‡ªå·±è²¬ä»»ã§è¡Œã£ã¦ãã ã•ã„ã€‚å¿…ãšæœ€åˆã«å°‘æ•°ã®å•†å“ã§ãƒ†ã‚¹ãƒˆã—ã¦ãã ã•ã„ã€‚ä½œè€…ã¯æ„å›³ã—ãªã„ä¾¡æ ¼å¤‰æ›´ã‚„é‡‘éŠ­çš„æå¤±ã«ã¤ã„ã¦è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚

---

## English

A Firefox extension that automates bulk price adjustments for Mercari Shops products. The extension temporarily discounts products and automatically restores original prices based on time delays or order count thresholds.

## ğŸŒŸ Key Features

- **Bulk Price Adjustment**: Automatically adjust prices for all shop products
- **Smart Product Exclusion**: Excludes products with orders in "ç™ºé€å¾…ã¡" (waiting for shipment) status
- **Minimum Price Floor (300 JPY)**: Products that would drop below 300 JPY are increased instead
- **Dual Restore Triggers**: 
  - **Time-based**: Restore after a specified number of minutes
  - **Order-based**: Restore when new order threshold is reached (whichever comes first)
- **Real-time Monitoring**: Track progress and statistics in the popup UI
- **Background Operation**: Runs without interfering with browser usage
- **Bilingual Support**: Full internationalization (English/Japanese)

## ğŸ”§ Installation

### For Users

1. **Download the extension** from Firefox Add-ons (once published) or load manually:
   - Download or clone this repository
   - Open Firefox and navigate to `about:debugging`
   - Click "This Firefox"
   - Click "Load Temporary Add-on"
   - Select the `manifest.json` file from this project

2. **That's it!** No additional software needed. The extension runs entirely in your browser.

### For Developers

**Prerequisites** (only for development/testing):
- Node.js and npm (for development tools and testing)
- Firefox browser

**Development Setup:**

1. **Install dependencies:**
   ```bash
   npm install
   ```

2. **Install web-ext globally (optional but recommended):**
   ```bash
   npm install -g web-ext
   ```

## ğŸš€ Development

### Run the extension in Firefox

```bash
npm start
```

This will:
- Launch Firefox with the extension loaded
- Watch for file changes and reload automatically
- Open the browser console for debugging

### Build the extension

```bash
npm run build
```

Creates a `.zip` file in `web-ext-artifacts/` for submission to Mozilla Add-ons.

### Lint the extension

```bash
npm run lint
```

### Run tests

```bash
npm test
```

**Note**: Node.js and npm are only required for development tools (`web-ext`, unit testing). The extension itself runs entirely in Firefox without any external dependencies.

## ğŸ“‹ First-Time Configuration

1. **Install the extension** in Firefox:
   - Via `npm start` (for developers), OR
   - Manually via `about:debugging` â†’ "Load Temporary Add-on" â†’ select `manifest.json`
2. **Click the extension icon** in the Firefox toolbar
3. **Enter your Shop ID**:
   - Find this in the URL when viewing your shop on mercari-shops.com
   - Example: `XbbLgd8ehsPWW6LWQKPGzN`
4. **Click "Save & Continue"**

The extension uses your browser's session cookies to authenticate with Mercari Shops, so no API tokens are needed.

### Authentication Method

The extension uses the **Web GraphQL endpoint** (`https://mercari-shops.com/graphql`) which:
- Uses your browser's login session (cookies)
- Bypasses IP whitelist requirements
- No API tokens needed
- Requires you to be logged into mercari-shops.com

## ğŸ“– How to Use

### Basic Workflow

1. **Ensure you're logged into** mercari-shops.com in Firefox
2. **Click the extension icon** to open the popup
3. **Configure automation settings**:
   - **Discount Amount**: Amount in JPY to discount (e.g., 100, 200)
   - **Restore Delay**: Time in minutes before automatic restore (e.g., 60)
   - **Order Threshold**: Number of new orders that trigger immediate restore (e.g., 3)
   - **Monitoring Interval**: How often to check for new orders in seconds (e.g., 30)
4. **Click "Start Price Adjustment"**
5. **Monitor progress** in the popup UI
6. Prices restore automatically, or click **"Stop & Restore Prices"** to restore immediately

### Test Price Change (Optional)

Before running a full automation, you can test price changes on a single product:

1. Click **"Test Price Change"** button
2. Enter a **Product ID**
3. Enter a **New Price** (minimum 300 JPY)
4. Click **"Test Price Change"**
5. Verify the price change succeeded

## ğŸ”„ How It Works

### Phase A: Price Adjustment

1. Fetches all products from your shop
2. Identifies products with orders in "ç™ºé€å¾…ã¡" (waiting for shipment) status
3. **Excludes** products with pending shipments
4. For **eligible products**:
   - **Standard case**: `new_price = original_price - discount_amount`
   - **Below 300 JPY case**: `new_price = original_price + discount_amount` (inverted)
5. Updates products via Mercari Shops GraphQL API

### Phase B: Monitoring & Restore

1. Monitors new orders at the specified interval (e.g., every 30 seconds)
2. Tracks orders placed **after Phase A completes** (baseline)
3. Restores prices when:
   - **Order threshold is reached**, OR
   - **Time delay expires** (whichever comes first)
4. All prices restored to original values
5. **Restore triggers only once** per automation run

### Price Calculation Examples

| Original Price | Discount | Result | Reason |
|----------------|----------|--------|--------|
| 1,000 JPY | 100 JPY | 900 JPY | Standard discount |
| 750 JPY | 200 JPY | 550 JPY | Standard discount |
| 399 JPY | 100 JPY | 499 JPY | Inverted (would be â‰¤300 JPY) |
| 350 JPY | 100 JPY | 450 JPY | Inverted (would be â‰¤300 JPY) |
| 301 JPY | 50 JPY | 351 JPY | Inverted (would be â‰¤300 JPY) |

## ğŸ§ª Testing

### Interactive Test Page

Access the test page via **Tools/Settings menu** (or right-click extension icon â†’ Options):

#### API Tests
- **Connection Test**: Verify API authentication
- **Get Shop ID**: Retrieve your shop ID
- **Get Products**: Fetch product list
- **Get Orders**: Fetch order list
- **Get Orders Waiting**: Fetch products with pending shipments
- **Get Product Details**: Get full product data for editing
- **Update Price**: Test price change on a single product

#### Gherkin Scenario Tests

Real automation tests with live price changes and countdown timers:

1. **Scenario 1: Standard Price Adjustment**
   - Tests standard discount calculation
   - Products discounted and restored after delay

2. **Scenario 2: Minimum Price Floor (300 yen)**
   - Tests products that would go below 300 yen
   - Verifies inverted behavior (increase instead of decrease)

3. **Scenario 3: Product Exclusion (ç™ºé€å¾…ã¡)**
   - Tests that products with pending shipments are excluded
   - Verifies excluded products remain unchanged

**âš ï¸ Warning**: Scenario tests actually change product prices on your Mercari Shops account. Use with caution!

### Unit Tests

Run unit tests for business logic:

```bash
npm test
```

Tests cover:
- Price calculation logic
- Product exclusion logic
- Restore trigger logic
- Configuration validation
- Completion and correctness

## ğŸ—‚ï¸ Project Structure

```
.
â”œâ”€â”€ manifest.json           # Extension manifest (configuration)
â”œâ”€â”€ background.js           # Background script (price automation logic)
â”œâ”€â”€ content.js             # Content script (runs on web pages)
â”œâ”€â”€ popup.html             # Popup UI (configuration form)
â”œâ”€â”€ popup.js               # Popup script (UI logic)
â”œâ”€â”€ popup.css              # Popup styles
â”œâ”€â”€ test.html              # Interactive test page
â”œâ”€â”€ test.js                # Test page API tests
â”œâ”€â”€ test-gherkin.js        # Gherkin scenario tests
â”œâ”€â”€ api/
â”‚   â””â”€â”€ mercari-api.js     # Mercari Shops GraphQL API client
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ i18n.js            # Internationalization helper
â”œâ”€â”€ _locales/              # i18n strings
â”‚   â”œâ”€â”€ en/
â”‚   â”‚   â””â”€â”€ messages.json
â”‚   â””â”€â”€ ja/
â”‚       â””â”€â”€ messages.json
â”œâ”€â”€ icons/                 # Extension icons
â”œâ”€â”€ tests/                 # Unit tests
â”‚   â”œâ”€â”€ test-runner.js
â”‚   â”œâ”€â”€ test-price-adjustment.js
â”‚   â”œâ”€â”€ test-product-exclusion.js
â”‚   â”œâ”€â”€ test-restore-triggers.js
â”‚   â”œâ”€â”€ test-configuration.js
â”‚   â””â”€â”€ test-completion.js
â”œâ”€â”€ package.json           # Node.js dependencies
â”œâ”€â”€ gherkin-tests.md       # Detailed Gherkin specifications
â”œâ”€â”€ specs.md               # Technical specifications
â””â”€â”€ README.md              # This file
```

## ğŸ” Key Implementation Details

### API Client

The extension uses the Mercari Shops **Web GraphQL endpoint**:
- **Endpoint**: `https://mercari-shops.com/graphql`
- **Authentication**: Browser session cookies (automatic)
- **No API tokens required**
- **No IP whitelist restrictions**

### Product Data Model

Products are fetched with the following structure:
```javascript
{
  id: "product_id",
  name: "Product Name",
  price: 1000,
  status: "STATUS_UNOPENED",
  variants: [
    {
      id: "variant_id",
      name: "Variant Name",
      quantity: 10,
      stockSnapshotId: "snapshot_id"
    }
  ],
  snapshotId: "product_snapshot_id"
}
```

### Order Filtering

Orders are monitored using the following query:
```graphql
query ShopOrdersPage($shopId: String!, $statuses: [OrderStatus!]!) {
  orders(shopId: $shopId, statuses: $statuses) {
    edges {
      node {
        id
        status
        orderProducts {
          productId
        }
      }
    }
  }
}
```

**Excluded order statuses**:
- `STATUS_WAITING_SHIPPING`
- `WAITING_FOR_SHIPPING`
- `SHIPPING_WAIT`

### Product Ledger

Each automation run maintains a ledger to track changes:
```javascript
{
  productId: "product_id",
  productName: "Product Name",
  originalPrice: 1000,
  appliedPrice: 900,
  adjustmentType: "discounted", // or "increased"
  excluded: false,
  updateStatus: "success", // or "failed", "pending"
  restored: false,
  timestamp: 1234567890
}
```

## ğŸ› Troubleshooting

### Extension Not Working

1. **Verify you're logged into mercari-shops.com**
   - Open mercari-shops.com in Firefox
   - Ensure you're logged in to your shop account

2. **Check Shop ID**
   - Extension popup â†’ Should show configuration screen or main UI
   - If you see "Shop ID required", enter your shop ID from the URL

3. **Check browser console**
   - Right-click extension icon â†’ Inspect
   - Look for errors in the console

### Price Changes Not Applied

1. **Verify API connection**
   - Open test page (Options menu)
   - Click "Test Connection"
   - Should show "Connection successful!"

2. **Check product status**
   - Products with pending shipments are automatically excluded
   - Check test page "Get Orders Waiting" to see excluded products

3. **Verify product details**
   - Use test page "Get Product Details" with a product ID
   - Ensure product has required fields (snapshotId, variants)

### Restore Not Triggering

1. **Check automation state**
   - Popup shows current phase (Phase A, Phase B, Restoring, Complete)
   - Time remaining countdown shows expected restore time

2. **Verify order threshold**
   - "New orders since start" counter in popup
   - Only orders placed **after Phase A completes** count toward threshold

3. **Check monitoring interval**
   - Orders checked every N seconds (as configured)
   - May take up to one interval cycle to detect new orders

## ğŸ“ Specifications

Detailed specifications are available in:
- **`gherkin-tests.md`**: Gherkin/BDD scenario specifications
- **`specs.md`**: Technical test specifications

## ğŸ¤ Contributing

1. Fork the repository
2. Create a feature branch
3. Make changes and test thoroughly
4. Run `npm test` to ensure tests pass
5. Run `npm run lint` to check code style
6. Submit a pull request

## ğŸ“„ License

MIT License

## ğŸ”— Resources

- [MDN WebExtensions Documentation](https://developer.mozilla.org/docs/Mozilla/Add-ons/WebExtensions)
- [Firefox Extension Workshop](https://extensionworkshop.com/)
- [web-ext Tool Documentation](https://extensionworkshop.com/documentation/develop/getting-started-with-web-ext/)
- [Mercari Shops](https://mercari-shops.com/)

## âš ï¸ Disclaimer

This extension modifies product prices on your Mercari Shops account. Use at your own risk. Always test with a small set of products first. The authors are not responsible for any unintended price changes or financial losses.

## ğŸ†˜ Support

For issues, questions, or feature requests, please open an issue on the GitHub repository.